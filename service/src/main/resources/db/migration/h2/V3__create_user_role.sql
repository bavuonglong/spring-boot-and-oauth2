CREATE TABLE USER (
  ID INT GENERATED BY DEFAULT AS IDENTITY,
  ENCRYPTED_PASSWORD VARCHAR(255),
  USERNAME VARCHAR(255),
  ENABLED BOOLEAN,
  DATE_CREATED TIMESTAMP,
  LAST_UPDATED TIMESTAMP,
  PRIMARY KEY (ID)
);

ALTER TABLE USER ADD CONSTRAINT USER_USER_NAME UNIQUE(USERNAME);

CREATE TABLE USER_HISTORY (
  ID INT GENERATED BY DEFAULT AS IDENTITY,
  DATE_CREATED TIMESTAMP,
  LAST_UPDATED TIMESTAMP,
  USER_ID INT,
  PRIMARY KEY (ID)
);

ALTER TABLE USER_HISTORY ADD CONSTRAINT USER_HISTORY_USER FOREIGN KEY (USER_ID) REFERENCES USER;

CREATE TABLE ROLE (
  ID INT GENERATED BY DEFAULT AS IDENTITY,
  ROLE_NAME VARCHAR(255),
  DATE_CREATED TIMESTAMP,
  LAST_UPDATED TIMESTAMP,
  PRIMARY KEY (ID)
);

ALTER TABLE ROLE ADD CONSTRAINT ROLE_ROLE_NAME UNIQUE(ROLE_NAME);

CREATE TABLE USERS_ROLES (
   USER_ID INT NOT NULL,
   ROLE_ID INT NOT NULL,
   PRIMARY KEY (USER_ID, ROLE_ID)
);

ALTER TABLE USERS_ROLES ADD CONSTRAINT USERS_ROLES_ROLE
   FOREIGN KEY (ROLE_ID) REFERENCES ROLE;

ALTER TABLE USERS_ROLES ADD CONSTRAINT USERS_ROLES_USER_
   FOREIGN KEY (USER_ID) REFERENCES USER;